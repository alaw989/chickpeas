---
phase: 04-specials-section
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - nuxt.config.ts
  - server/api/specials.get.ts
  - composables/useSpecialsData.ts
  - components/sections/HomeSpecials.vue
  - components/sections/HomePage.vue
  - pages/index.vue
autonomous: true

must_haves:
  truths:
    - "Specials section appears below hero when specials exist in WordPress"
    - "Each special displays photo, name, price, and description"
    - "Multiple specials render in a responsive grid/row layout"
    - "Section is completely hidden when no specials are published"
    - "Adding/removing specials in WordPress updates the site (ISR revalidation)"
  artifacts:
    - path: "server/api/specials.get.ts"
      provides: "WordPress REST API proxy for specials"
      exports: ["default"]
    - path: "composables/useSpecialsData.ts"
      provides: "Specials data composable"
      exports: ["useSpecialsData"]
    - path: "components/sections/HomeSpecials.vue"
      provides: "Specials section component"
      min_lines: 40
  key_links:
    - from: "composables/useSpecialsData.ts"
      to: "/api/specials"
      via: "useAsyncData with $fetch"
      pattern: "\\$fetch.*api/specials"
    - from: "components/sections/HomeSpecials.vue"
      to: "useSpecialsData"
      via: "composable import or prop"
      pattern: "(useSpecialsData|specials.*prop)"
    - from: "components/sections/HomePage.vue"
      to: "HomeSpecials"
      via: "component import and conditional render"
      pattern: "HomeSpecials|v-if.*specials"
---

<objective>
Implement the specials section for the homepage that displays WordPress-managed daily specials.

Purpose: Allow restaurant staff to manage specials via WordPress admin, with changes automatically reflected on the homepage via ISR.

Output: Working specials section that fetches from WordPress REST API, displays photo/name/price/description for each special, and hides completely when no specials exist.
</objective>

<execution_context>
@/Users/austinlaw/.claude/get-shit-done/workflows/execute-plan.md
@/Users/austinlaw/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing patterns to follow
@server/api/menu.get.ts
@composables/useMenuData.ts
@components/sections/HomePage.vue
@nuxt.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create specials API endpoint and composable</name>
  <files>
    nuxt.config.ts
    server/api/specials.get.ts
    composables/useSpecialsData.ts
  </files>
  <action>
1. Add `wpSpecialsEndpoint` to `nuxt.config.ts` runtimeConfig (server-only, same pattern as wpMenuEndpoint):
   ```
   wpSpecialsEndpoint: process.env.WP_SPECIALS_ENDPOINT || 'https://wp.chickpeas-mobile.com/wp-json/wp/v2/specials?per_page=10&_embed'
   ```
   Note: Using `_embed` to include featured image in response.

2. Create `server/api/specials.get.ts` following the menu.get.ts pattern:
   - Define `Special` interface: { id, title, excerpt (description), price (ACF/custom field), featured_media_url (from _embedded) }
   - Fetch from WordPress endpoint configured in runtimeConfig
   - Transform WordPress response to clean Special[] format
   - Set cache headers: `Cache-Control: public, max-age=0, s-maxage=300, stale-while-revalidate=600` (same as menu)
   - Handle empty response (return empty array, not error)
   - Include fallback to empty array if endpoint not configured (for local dev without WP)

3. Create `composables/useSpecialsData.ts` following useMenuData.ts pattern exactly:
   ```typescript
   export const useSpecialsData = () => {
     return useAsyncData('specials-data', () => $fetch('/api/specials'), {
       server: true
     })
   }
   ```

Expected WordPress response shape (with _embed):
```json
[{
  "id": 123,
  "title": { "rendered": "Lamb Gyro Special" },
  "excerpt": { "rendered": "<p>Description here</p>" },
  "acf": { "price": "12.99" },
  "_embedded": {
    "wp:featuredmedia": [{ "source_url": "https://..." }]
  }
}]
```

Transform to clean shape:
```typescript
interface Special {
  id: number
  name: string
  description: string
  price: string | null
  image: string | null
}
```
  </action>
  <verify>
    - `npm run build` succeeds without type errors
    - `curl http://localhost:3000/api/specials` returns JSON array (empty is OK if WP not configured)
  </verify>
  <done>
    - API endpoint exists and responds with Special[] or empty array
    - Composable exports useSpecialsData function
    - nuxt.config.ts has wpSpecialsEndpoint in runtimeConfig
  </done>
</task>

<task type="auto">
  <name>Task 2: Create HomeSpecials component</name>
  <files>
    components/sections/HomeSpecials.vue
  </files>
  <action>
Create `components/sections/HomeSpecials.vue` component:

1. Props:
   - `specials: Special[]` (required)
   - Component renders nothing (v-if="false" or empty template) when specials.length === 0

2. Layout requirements:
   - Section wrapper with consistent padding (match other sections)
   - Heading: "Today's Specials" or similar
   - Responsive grid: 1 col mobile, 2 cols md, 3 cols lg (or flex row that wraps)
   - Use existing site color palette (green #3f6e4d, cream #fff0de, accent #e6fbcc)

3. Each special card displays:
   - Photo (use NuxtImg with placeholder, fallback to generic food image if null)
   - Name (title, prominent)
   - Price (styled, formatted with $)
   - Description (truncated to ~2 lines)

4. Styling guidelines:
   - Match existing site aesthetic (see HomeInfo.vue, Menu.vue)
   - Cards with subtle shadow or border
   - Responsive image handling (aspect-ratio or fixed height with object-cover)
   - Use @vueuse/motion for subtle entrance animation (visible-once, same pattern as other sections)

5. Animation (follow existing patterns):
   - Section fade-in on scroll using v-motion directive
   - Use `visible-once` preset with subtle fade/slide
   - Stagger card animations if multiple specials (50ms interval per card)

TypeScript interface (define in component or import from types):
```typescript
interface Special {
  id: number
  name: string
  description: string
  price: string | null
  image: string | null
}
```
  </action>
  <verify>
    - Component file exists and exports default
    - `npm run build` succeeds
    - Component renders nothing when specials prop is empty array
  </verify>
  <done>
    - HomeSpecials.vue created with photo, name, price, description display
    - Responsive grid layout (1/2/3 columns)
    - Empty state renders nothing (section hidden)
    - Animations follow existing site patterns
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate specials into homepage</name>
  <files>
    pages/index.vue
    components/sections/HomePage.vue
  </files>
  <action>
1. Update `pages/index.vue`:
   - Import useSpecialsData composable
   - Fetch specials data: `const { data: specialsData } = await useSpecialsData()`
   - Pass to HomePage component: `:specialsData="specialsData || []"`

2. Update `components/sections/HomePage.vue`:
   - Add prop: `specialsData: { type: Array, default: () => [] }`
   - Import HomeSpecials: `const Specials = defineAsyncComponent(() => import('~/components/sections/HomeSpecials.vue'))`
   - Add specials section AFTER hero, BEFORE triangle:
     ```vue
     <!-- Specials section - only renders when specials exist -->
     <Specials v-if="specialsData.length > 0" :specials="specialsData" />
     ```
   - Position: Below hero section, above the triangle divider
   - The section should integrate visually (background color transition from hero to specials to triangle)

3. Section ordering in HomePage.vue template:
   - Hero section (existing)
   - Specials section (NEW - conditional)
   - Triangle divider (existing)
   - Info section (existing)
   - Menu section (existing)
   - Location section (existing)

4. Visual integration:
   - If specials section has cream background (#fff0de), ensure smooth transition from hero
   - Or use white/light background with sufficient contrast
   - Triangle divider should still work visually after specials section
  </action>
  <verify>
    - `npm run dev` starts without errors
    - Homepage loads successfully
    - If API returns empty array: no specials section visible, page looks unchanged
    - If API returns specials: section appears below hero with cards
  </verify>
  <done>
    - Specials section appears below hero when specials exist
    - Section hidden when no specials (page looks unchanged)
    - Data flows: WordPress -> API -> Composable -> Page -> Component
    - Visual integration is clean (no jarring transitions)
  </done>
</task>

</tasks>

<verification>
1. Build verification: `npm run build` completes without errors
2. Dev server: `npm run dev` starts successfully
3. API test: `curl http://localhost:3000/api/specials` returns valid JSON
4. Empty state: With no WordPress specials, homepage looks unchanged (no specials section)
5. With data: If WordPress has specials, they display correctly below hero
6. Responsive: Specials grid adapts to mobile/tablet/desktop
7. ISR: After WordPress update, site reflects changes within 5 minutes (s-maxage=300)
</verification>

<success_criteria>
- SPEC-01: Specials section displays below hero on homepage (when specials exist)
- SPEC-02: Each special shows photo, name, price, description
- SPEC-03: Section supports multiple specials (grid layout)
- SPEC-04: Section hidden when no active specials exist
- SPEC-05: Specials manageable from WordPress admin (custom post type assumed to exist)
</success_criteria>

<output>
After completion, create `.planning/phases/04-specials-section/04-01-SUMMARY.md`
</output>
